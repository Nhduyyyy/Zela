@using Zela.ViewModels
@model IEnumerable<Zela.ViewModels.UserWithFriendshipStatus>
@{
    ViewData["Title"] = "T√¨m b·∫°n m·ªõi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/friend-find.css" />
}

<div class="container" style="max-width: 700px; margin: 40px auto;">
    <h2>@ViewData["Title"]</h2>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <!-- üîç Form t√¨m ki·∫øm -->
    <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="T√¨m b·∫°n..." />
    </div>

    <!-- üîΩ K·∫øt qu·∫£ t√¨m ki·∫øm -->
    <div class="table-responsive" id="searchResults">
        <table class="table table-striped mt-4">
            <thead>
                <tr>
                    <th>UserId</th>
                    <th>UserName</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="resultsBody">
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.UserId</td>
                        <td>@user.UserName</td>
                        <td>
                            @switch (user.Role)
                            {
                                case FriendshipRole.None:
                                    @:<span class="text-muted">Ch∆∞a l√† b·∫°n</span>
                                    break;
                                case FriendshipRole.PendingSent:
                                    @:<span class="text-info">ƒê√£ g·ª≠i l·ªùi m·ªùi</span>
                                    break;
                                case FriendshipRole.PendingReceived:
                                    @:<span class="text-warning">C√≥ l·ªùi m·ªùi ƒë·∫øn</span>
                                    break;
                                case FriendshipRole.Accepted:
                                    @:<span class="text-success">ƒê√£ l√† b·∫°n</span>
                                    break;
                            }
                        </td>
                        <td>
                            @switch (user.Role)
                            {
                                case FriendshipRole.None:
                                    <form asp-action="SendRequest" method="post" class="mb-0">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="userId2" value="@user.UserId" />
                                        <button type="submit" class="btn btn-sm btn-primary">K·∫øt b·∫°n</button>
                                    </form>
                                    break;
                                case FriendshipRole.PendingSent:
                                    @:<span class="text-secondary">ƒêang ch·ªù</span>
                                    break;
                                case FriendshipRole.PendingReceived:
                                    @:<span class="text-secondary">Ch·ªù ph·∫£n h·ªìi</span>
                                    break;
                                case FriendshipRole.Accepted:
                                    <form asp-action="RemoveFriend" method="post" class="mb-0">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="friendId" value="@user.UserId" />
                                        <button type="submit" class="btn btn-sm btn-danger">H·ªßy b·∫°n</button>
                                    </form>
                                    break;
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-center mt-4">
        <a asp-action="Index" class="btn btn-secondary">Quay v·ªÅ</a>
    </div>
</div>

@section Scripts {
    <script src="~/js/friend-search.js"></script>
}

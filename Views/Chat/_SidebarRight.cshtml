@model Zela.ViewModels.FriendViewModel
<div class="chat-info-panel">
    <div class="info-header">
        <h4><i class="bi bi-info-circle me-2"></i>Thông tin hội thoại</h4>
    </div>

    <div class="group-meta">
        <div class="user-info">
            <div class="user-avatar-panel-container text-center mb-3">
                <img class="user-avatar rounded-circle" src="@Model.AvatarUrl" alt="Avatar" style="width: 80px; height: 80px; object-fit: cover;"/>
            </div>
            <div class="user-details text-center">
                <h5 class="user-name">@Model.FullName</h5>
                <p class="user-email text-muted">@Model.Email</p>
                <span class="user-status @(Model.IsOnline ? "online" : "offline")">
                    <i class="bi bi-circle-fill"></i>
                    @(Model.IsOnline ? "Online" : "Offline")
                </span>
                @if (!string.IsNullOrEmpty(Model.LastTime))
                {
                    <p class="user-last-seen text-muted small">Hoạt động lúc @Model.LastTime</p>
                }
            </div>
        </div>

        <div class="group-actions">
            <button class="btn">
                <i class="bi bi-bell-slash me-1"></i>Tắt thông báo
            </button>
            <button class="btn">
                <i class="bi bi-pin me-1"></i>Ghim hội thoại
            </button>
            <button class="btn">
                <i class="bi bi-telephone me-1"></i>Gọi điện
            </button>
            <button class="btn">
                <i class="bi bi-camera-video me-1"></i>Gọi video
            </button>
            <a>Tìm kiếm tin nhắn</a>
        </div>
    </div>
    
    @* search message *@
    <div class="search-message-section">
        <div class="search-message-input-group">
            <input type="text" id="searchMessageInput" class="form-control" placeholder="Tìm kiếm tin nhắn...">
            <button id="searchMessageBtn" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-search"></i>
            </button>
        </div>
        <div id="searchMessageResults" class="search-message-results"></div>
    </div>

    <div class="info-section">
        <h6><i class="bi bi-newspaper me-2"></i>Bảng tin</h6>
        <ul class="list-unstyled">
            <li class="mb-2">
                <i class="bi bi-bell text-warning me-2"></i>
                <a href="#" class="text-decoration-none">Danh sách nhắc hẹn</a>
            </li>
            <li>
                <i class="bi bi-sticky text-info me-2"></i>
                <a href="#" class="text-decoration-none">Ghi chú, ghim, bình chọn</a>
            </li>
        </ul>
    </div>

    <div class="info-section">
        <h6><i class="bi bi-images me-2"></i>Ảnh/Video</h6>
        @if (Model.Images.Count > 0 || Model.Videos.Count > 0)
        {
            <div class="media-grid">
                @{
                    var allMedia = Model.Images.Take(6).Select(img => new { Type = "image", Item = img })
                                    .Concat(Model.Videos.Take(6 - Model.Images.Count).Select(vid => new { Type = "video", Item = vid }))
                                    .Take(6).ToList();
                }
                @foreach (var media in allMedia)
                {
                    if (media.Type == "image")
                    {
                        <img src="@media.Item.Url" alt="Ảnh đã chia sẻ" style="width: 100%; height: 100%; object-fit: cover;">
                    }
                    else
                    {
                        <video src="@media.Item.Url" alt="Video đã chia sẻ" style="width: 100%; height: 100%; object-fit: cover;" muted>
                            <source src="@media.Item.Url" type="@media.Item.MediaType">
                        </video>
                    }
                }
            </div>
            <a href="#" class="view-all-link">
                <i class="bi bi-arrow-right me-1"></i>Xem tất cả (@(Model.Images.Count + Model.Videos.Count) items)
            </a>
        }
        else
        {
            <div class="text-muted">Chưa có ảnh hoặc video nào được chia sẻ.</div>
        }
    </div>

    <div class="info-section">
        <h6><i class="bi bi-files me-2"></i>File đã chia sẻ</h6>
        @if (Model.Files.Count > 0)
        {
            <ul class="file-list">
                @foreach (var file in Model.Files.Take(3))
                {
                    <li class="file-item">
                        @{
                            var fileExtension = System.IO.Path.GetExtension(file.FileName ?? file.Url)?.ToLower();
                            var iconClass = fileExtension switch
                            {
                                ".doc" or ".docx" => "bi-file-earmark-word-fill",
                                ".xls" or ".xlsx" => "bi-file-earmark-excel-fill text-success",
                                ".ppt" or ".pptx" => "bi-file-earmark-ppt-fill text-warning",
                                ".pdf" => "bi-file-earmark-pdf-fill text-danger",
                                ".txt" => "bi-file-earmark-text-fill",
                                _ => "bi-file-earmark-fill"
                            };
                        }
                        <i class="bi @iconClass"></i>
                        <div class="file-details">
                            <p class="file-name">@(file.FileName ?? System.IO.Path.GetFileName(file.Url))</p>
                            <p class="file-size">File</p>
                        </div>
                        <a href="@file.Url" download="@(file.FileName ?? System.IO.Path.GetFileName(file.Url))" class="file-download-btn" title="Tải về">
                            <i class="bi bi-download"></i>
                        </a>
                    </li>
                }
            </ul>
            @if (Model.Files.Count > 5)
            {
                <a href="#" class="view-all-link">
                    <i class="bi bi-arrow-right me-1"></i>Xem tất cả (@Model.Files.Count files)
                </a>
            }
        }
        else
        {
            <div class="text-muted">Chưa có file nào được chia sẻ.</div>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/search-message.js"></script>
}
